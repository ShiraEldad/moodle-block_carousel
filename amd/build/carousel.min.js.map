{"version":3,"file":"carousel.min.js","sources":["../src/carousel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Load the carousel.\n *\n * @module    block_carousel/carousel\n * @copyright 2016 Brendan Heywood (brendan@catalyst-au.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_factory', 'core/ajax', 'block_carousel/slick'], function($, ModalFactory, Ajax) {\n    return {\n        init: function(blockid, numslides, autoplay, playspeed) {\n            $('#carousel' + blockid + ' .slidewrap').show();\n\n            // Setup breakpoint array.\n            // Breakpoints set to 1 above the standard width, as expressions like >= 1024 don't work.\n            if (numslides > 1) {\n                var breakpoints = [{\n                    breakpoint: 1025,\n                    settings: {\n                        slidesToShow: 2,\n                    }\n                }, {\n                    breakpoint: 769,\n                    settings: {\n                        slidesToShow: 1,\n                    }\n                }];\n            } else {\n                var breakpoints = [];\n            }\n\n            var carousel = $('#carousel' + blockid);\n            carousel.slick({\n                dots: true,\n                infinite: true,\n                speed: 300,\n                slidesToShow: numslides,\n                adaptiveHeight: true,\n                autoplay: autoplay,\n                autoplaySpeed: playspeed,\n                responsive: breakpoints\n            });\n\n            // This is a special case for when carousel is embedded in another block.\n            // When the carousel is resized, we need to resize.\n            // This causes slick to natively resize itself.\n            var observer = new ResizeObserver(function() {\n                $(window).trigger('resize');\n            });\n\n            observer.observe(carousel.get('0'));\n        },\n\n        modal: function(rowid, modalTitle) {\n            var slide = document.querySelector('#id_slide' + rowid);\n            slide.addEventListener('click', function(){\n                ModalFactory.create(\n                    {\n                        type: ModalFactory.types.CANCEL,\n                        title: modalTitle,\n                        body: slide.dataset.modalcontent\n                    }\n                ).then($.proxy(function(modal) {\n                    modal.getRoot().addClass('block_carousel');\n\n                    modal.setLarge();\n                    modal.show();\n                }));\n            });\n        },\n\n        videocontrol: function(blockid, slideid) {\n            var videocontrol = function() {\n                var video = document.querySelector('#id_slidevideo' + slideid);\n                var slideparent = $('#id_slidecontainer' + slideid).parents('.slick-slide');\n                if (slideparent.attr('aria-hidden') === 'false') {\n                    // This is the active slide. Unpause the video with this slideID.\n                    video.play();\n                } else {\n                    // Non active slide. Pause it.\n                    video.pause();\n                }\n            };\n            var carousel = $('#carousel' + blockid);\n            carousel.on('afterChange', videocontrol);\n            carousel.on('init', videocontrol);\n        },\n\n        interaction: function(slideid) {\n            var slide = document.querySelector('#id_slide' + slideid);\n            slide.addEventListener('click', function(){\n                var request = {\n                    methodname: 'block_carousel_record_interaction',\n                    args: {\n                        rowid: slideid\n                    }\n                };\n                Ajax.call([request])[0].fail();\n            });\n        }\n    };\n});\n"],"names":["define","$","ModalFactory","Ajax","init","blockid","numslides","autoplay","playspeed","show","breakpoints","breakpoint","settings","slidesToShow","carousel","slick","dots","infinite","speed","adaptiveHeight","autoplaySpeed","responsive","ResizeObserver","window","trigger","observe","get","modal","rowid","modalTitle","slide","document","querySelector","addEventListener","create","type","types","CANCEL","title","body","dataset","modalcontent","then","proxy","getRoot","addClass","setLarge","videocontrol","slideid","video","parents","attr","play","pause","on","interaction","request","methodname","args","call","fail"],"mappings":";;;;;;;AAsBAA,iCAAO,CAAC,SAAU,qBAAsB,YAAa,yBAAyB,SAASC,EAAGC,aAAcC,YAC7F,CACHC,KAAM,SAASC,QAASC,UAAWC,SAAUC,cACzCP,EAAE,YAAcI,QAAU,eAAeI,OAIrCH,UAAY,MACRI,YAAc,CAAC,CACfC,WAAY,KACZC,SAAU,CACNC,aAAc,IAEnB,CACCF,WAAY,IACZC,SAAU,CACNC,aAAc,UAIlBH,YAAc,OAGlBI,SAAWb,EAAE,YAAcI,SAC/BS,SAASC,MAAM,CACXC,MAAM,EACNC,UAAU,EACVC,MAAO,IACPL,aAAcP,UACda,gBAAgB,EAChBZ,SAAUA,SACVa,cAAeZ,UACfa,WAAYX,cAMD,IAAIY,gBAAe,WAC9BrB,EAAEsB,QAAQC,QAAQ,aAGbC,QAAQX,SAASY,IAAI,OAGlCC,MAAO,SAASC,MAAOC,gBACfC,MAAQC,SAASC,cAAc,YAAcJ,OACjDE,MAAMG,iBAAiB,SAAS,WAC5B/B,aAAagC,OACT,CACIC,KAAMjC,aAAakC,MAAMC,OACzBC,MAAOT,WACPU,KAAMT,MAAMU,QAAQC,eAE1BC,KAAKzC,EAAE0C,OAAM,SAAShB,OACpBA,MAAMiB,UAAUC,SAAS,kBAEzBlB,MAAMmB,WACNnB,MAAMlB,eAKlBsC,aAAc,SAAS1C,QAAS2C,aACxBD,aAAe,eACXE,MAAQlB,SAASC,cAAc,iBAAmBgB,SAEd,UADtB/C,EAAE,qBAAuB+C,SAASE,QAAQ,gBAC5CC,KAAK,eAEjBF,MAAMG,OAGNH,MAAMI,SAGVvC,SAAWb,EAAE,YAAcI,SAC/BS,SAASwC,GAAG,cAAeP,cAC3BjC,SAASwC,GAAG,OAAQP,eAGxBQ,YAAa,SAASP,SACNjB,SAASC,cAAc,YAAcgB,SAC3Cf,iBAAiB,SAAS,eACxBuB,QAAU,CACVC,WAAY,oCACZC,KAAM,CACF9B,MAAOoB,UAGf7C,KAAKwD,KAAK,CAACH,UAAU,GAAGI"}